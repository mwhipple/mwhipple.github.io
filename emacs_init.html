<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-07-28 Fri 15:16 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>My Emacs Configuration</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">My Emacs Configuration</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org08f3cdd">1. Define Header</a></li>
<li><a href="#orga601c0a">2. Check Preconditions</a>
<ul>
<li><a href="#org9fc0eac">2.1. JSON Support</a></li>
</ul>
</li>
<li><a href="#orgb48b3b0">3. Configure Package Management</a></li>
<li><a href="#orgc1a2811">4. Enable Desktop Preservation</a></li>
<li><a href="#orgb34c1f1">5. Customize Styling</a>
<ul>
<li><a href="#org3a415c3">5.1. Show Some Stuff</a></li>
<li><a href="#org74af343">5.2. Hide Some Stuff</a></li>
<li><a href="#org0bb4dbe">5.3. Go Dark</a></li>
<li><a href="#orgbfdc030">5.4. Tweak Mode Line</a></li>
</ul>
</li>
<li><a href="#org6c42044">6. Define Self Inserting Characters</a></li>
<li><a href="#org4e68770">7. Bind Some Low-Level Commands</a></li>
<li><a href="#org7db444a">8. Provide Some Basic Editing</a>
<ul>
<li><a href="#orgbe69b11">8.1. Insert Content</a></li>
<li><a href="#org5faae42">8.2. Remove Content</a></li>
</ul>
</li>
<li><a href="#orgfed016d">9. Support Moving Point Around Within a Buffer</a></li>
<li><a href="#org5a94cde">10. Change View of Buffer</a></li>
<li><a href="#org45ea22a">11. Play With Mark</a></li>
<li><a href="#orgf03abc9">12. Work with Kill Ring</a></li>
<li><a href="#org72b9a87">13. Provide Some Contextual Editing</a></li>
<li><a href="#org80cf6f4">14. Generate Content</a></li>
<li><a href="#orga528ef0">15. Searching and Potentially Replacing</a></li>
<li><a href="#orgc0b6b5c">16. Support Some Inter-Process Communication</a>
<ul>
<li><a href="#org0a147be">16.1. Support Invoking of External Commands</a></li>
</ul>
</li>
<li><a href="#orgb1d1ba7">17. Provide Some Global Dispatching</a>
<ul>
<li><a href="#org571b9be">17.1. Handle Escape Sequences from External Commands</a></li>
</ul>
</li>
<li><a href="#org0bdc3fa">18. Manage View Objects</a></li>
<li><a href="#org86dddf3">19. Help Me!</a></li>
<li><a href="#org64a594c">20. Bookmark Management</a></li>
<li><a href="#org11273b6">21. Define Some Minibuffer Bindings</a></li>
<li><a href="#org6bc0e90">22. Define Some Navigation Through a Project</a></li>
<li><a href="#orgd58a784">23. Interact With Source Control</a></li>
<li><a href="#org8f8599c">24. Configure Org Mode</a></li>
<li><a href="#orgff24eb4">25. Configure Dired Mode</a></li>
<li><a href="#org4cef713">26. Configure Org Agenda</a></li>
<li><a href="#org6d7ebd1">27. Configure hexl Mode</a></li>
<li><a href="#orgf960c05">28. Configure Info Mode</a></li>
<li><a href="#org5201d7f">29. Configure Emacs Lisp</a></li>
<li><a href="#org4cb938e">30. Manage Environment for Called Commands</a>
<ul>
<li><a href="#orgb56d76e">30.1. Customization Group</a></li>
<li><a href="#org388b67e">30.2. Expand Using Shell</a>
<ul>
<li><a href="#orgcfdcd07">30.2.1. Enveloper</a></li>
<li><a href="#org42f378a">30.2.2. Define the Called Commands</a></li>
<li><a href="#org1b8eb3f">30.2.3. Support Invoking the Commands</a></li>
<li><a href="#orgadb7876">30.2.4. Transplants</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org022c295">31. Structurizr Mode</a>
<ul>
<li><a href="#org8285092">31.1. Font Lock</a>
<ul>
<li><a href="#orgfbc5c31">31.1.1. Words for Face</a></li>
<li><a href="#orgdd8df78">31.1.2. List Collector</a></li>
<li><a href="#org9d445b5">31.1.3. Collect Categories of Known Words</a></li>
</ul>
</li>
<li><a href="#org28e35a0">31.2. Indentation</a>
<ul>
<li><a href="#orgdbe88f6">31.2.1. Configure Offset</a></li>
<li><a href="#org15ab8a3">31.2.2. Determine Indentation Level</a></li>
</ul>
</li>
<li><a href="#org2351021">31.3. Syntax Table</a></li>
<li><a href="#org1a69499">31.4. Associate with Extension</a></li>
</ul>
</li>
<li><a href="#org39caf2d">32. Programming Support</a>
<ul>
<li><a href="#orgc156ced">32.1. C</a></li>
</ul>
</li>
<li><a href="#orgc0c6fac">33. Configure Lilypond</a></li>
<li><a href="#orga3294d5">34. Configure Gnus</a></li>
<li><a href="#orgb38b95a">35. Configure EWW</a></li>
<li><a href="#org7c08f0c">36. Queue</a>
<ul>
<li><a href="#orgb86bc73">36.1. <span class="todo TODO">TODO</span> Find or define more expressive mode-alist registration</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
I use my Emacs configuration both as a means to customize it and to
document standard behavior. As a result much of it will strictly
unnecessary.
</p>

<p>
I'll also be looking to build up the configuration incrementally along
with supporting knowledge and will start with integrating desired
functionality directly into this file rather than pulling in external
packages. This ties in with an overall goal I have in software in
general to make consistent reuse of abstractions, and also can
hopefully address a concern I've had with Emacs in particular in the
past where it felt as though there was both too much code floating
around the ecosystem and too little readily composable functionality.
</p>

<p>
I'm currently using <code>^-</code> as a prefix for my local definitions.
This is inherited from a past project where I started to create a lot
of macros and since the "macs" in Emacs is for macros I was thinking
of it as macros squared&#x2026;so <code>^-</code> is in the spirit of that while also
being nice and short.
</p>

<p>
Over time I'll likely also look to evolve the configuration so that it
is increasingly declarative data structures operated upon by fewer
functions. This may ease reuse of the same configuration across
multiple targets as the number of operations to support will be reduced.
</p>

<div id="outline-container-org08f3cdd" class="outline-2">
<h2 id="org08f3cdd"><span class="section-number-2">1.</span> Define Header</h2>
<div class="outline-text-2" id="text-1">
<p>
Define some standard header boilerplate like copyright&#x2026;
most significantly define lexical binding.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;;; init.el -- Configure emacs to my liking. -*- lexical-binding: t; -*-

;; Copyright (C) 2023 Matt Whipple &lt;mattwhipple@acm.org&gt;

;; Author: Matt Whipple &lt;mattwhipple@acm.org&gt;
;; Maintainer: Matt Whiple &lt;mattwhipple@acm.org&gt;
;; Keywords: config
;; Package: ^-config
;; Package-Version: NA
;; Package-Requires: ((emacs "29.1") (dash "2.19.1")
;; Filename: init.el

;; This file is not part of GNU Emacs.

;; This is free software: you can redistribute it and/or modify
;; it under the terms of the GNU General Public License as published by
;; the Free Software Foundation, either version 3 of the License, or
;; (at your option) any later version.

;; This software is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;; GNU General Public License for more details.

;; You should have received a copy of the GNU General Public License
;; along with this file.  If not, see &lt;http://www.gnu.org/licenses/&gt;.

;;; Commentary:

;; This file will collect my configuration and documentation of emacs behavior,
;; along with being the initial location of any extensions on which I work.

;;; Code:

</pre>
</div>
</div>
</div>

<div id="outline-container-orga601c0a" class="outline-2">
<h2 id="orga601c0a"><span class="section-number-2">2.</span> Check Preconditions</h2>
<div class="outline-text-2" id="text-2">
<p>
I'll be making use of whatever seems readily available rather than
carefully tracking what features are available on what systems, but as
the lack of certain capabilities translate into errors on some system
or other I'll add tests with more helpful messages here. If any of
this code ends up being split out into libraries this should be
handled with more discipline (and compatibility options should be
explored).
</p>
</div>

<div id="outline-container-org9fc0eac" class="outline-3">
<h3 id="org9fc0eac"><span class="section-number-3">2.1.</span> JSON Support</h3>
<div class="outline-text-3" id="text-2-1">
<p>
This is required for EAF stuff and seems generally useful.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(unless (fboundp #'json-parse-buffer)
  (warn "Emacs does not have JSON support!"))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb48b3b0" class="outline-2">
<h2 id="orgb48b3b0"><span class="section-number-2">3.</span> Configure Package Management</h2>
<div class="outline-text-2" id="text-3">
<p>
I'm currently ideally being cautious about pulling in packages due to
the more ambitious goal of building out a more unified platform, but
some packages will be embraced and others will be used out of
pragmatism (particularly for professional work).
</p>

<p>
Here I'll configure some of the standard repositories.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(require 'package)
(setq package-archives '(("gnu" . "https://elpa.gnu.org/packages/")
                         ("melpa" . "https://melpa.org/packages/")))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgc1a2811" class="outline-2">
<h2 id="orgc1a2811"><span class="section-number-2">4.</span> Enable Desktop Preservation</h2>
<div class="outline-text-2" id="text-4">
<p>
Use desktop mode to save and restore desktops across invocations.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(desktop-save-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb34c1f1" class="outline-2">
<h2 id="orgb34c1f1"><span class="section-number-2">5.</span> Customize Styling</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org3a415c3" class="outline-3">
<h3 id="org3a415c3"><span class="section-number-3">5.1.</span> Show Some Stuff</h3>
<div class="outline-text-3" id="text-5-1">
<p>
I often have Emacs running full-screen so it's nice if it just provides
me info that I need in the status bar such as what time it is and how
much time until my battery will die and maybe other things that aren't
time related.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(display-battery-mode)
(display-time-mode)
(setq display-time-day-and-date t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org74af343" class="outline-3">
<h3 id="org74af343"><span class="section-number-3">5.2.</span> Hide Some Stuff</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Currently I'm very keyboard oriented and don't want to waste previous
screen real estate so I'd rather get rid of user interface elements
intended for other forms of interaction. I may revisit this as I look
at using Emacs across a wider range of devices.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(tool-bar-mode -1)
(menu-bar-mode -1)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0bb4dbe" class="outline-3">
<h3 id="org0bb4dbe"><span class="section-number-3">5.3.</span> Go Dark</h3>
<div class="outline-text-3" id="text-5-3">
<p>
I (like many people) generally prefer themes with dark
backgrounds. Emacs in particular looks particularly primitive with the
default white GUI background whereas on black it looks at least a bit
more retro. While I may be tempted at some point to fiddle with this a
bit more (especially given that it comes with some disclaimers) I'll
start with some code I stumbled upon within the Emacs code base (I
think frame.el&#x2026;I should link it when I come across it again).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-minor-mode dark-mode
  "Use light text on dark background."  
  :global t
  :group 'faces
  (when (eq dark-mode
            (eq 'light (frame--current-background-mode (selected-frame))))
    ;; FIXME: Change the face's SPEC instead?
    (set-face-attribute 'default nil
                        :foreground (face-attribute 'default :background)
                        :background (face-attribute 'default :foreground))
   (frame-set-background-mode (selected-frame))))
(dark-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbfdc030" class="outline-3">
<h3 id="orgbfdc030"><span class="section-number-3">5.4.</span> Tweak Mode Line</h3>
<div class="outline-text-3" id="text-5-4">
<p>
I don't remember what this setting does specifically, but I had it
sitting around in an old configuration and figured it was worth
pulling in to figure out later.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq-default
  mode-line-format
  (list "%b L%l %p " mode-line-misc-info))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6c42044" class="outline-2">
<h2 id="org6c42044"><span class="section-number-2">6.</span> Define Self Inserting Characters</h2>
<div class="outline-text-2" id="text-6">
<p>
Define and bind chose keys that result in the associated character
being inserted. This is particularly standard behavior as provided by
the terminal though Emacs does add some custom logic. These are
defined in a variable for subsequent specialization (there is likely a
more idiomatic way to do that such as using remap but I haven't gotten
that far yet.
</p>

<p>
This makes use of the relatively new <code>keymap-set</code> function which
replaces <code>define-key</code>. Elsewhere will primarily use the `bind-key`
family of macros but this make more direct use of the core
functionality as it lends itself more readily to composition (and
there's no clear value in using anything fancier). I'd generally be on
the fence about using <code>bind-key</code> but since it's now included in Emacs
it's hard to resist. I'm fairly likely to switch that out later in
favor of something simpler like <code>define-keymap</code> as I build out my Emacs knowledge.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setq self-insert-keys
      '(
        "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m"			   
        "A" "B" "C" "D" "E" "F" "G" "H" "I" "J" "K" "L" "M"
        "n" "o" "p" "q" "r" "s" "t" "u" "v" "w" "x" "y" "z"
        "N" "O" "P" "Q" "R" "S" "T" "U" "V" "W" "X" "Y" "Z"
        "0" "1" "2" "3" "4" "5" "6" "7" "8" "9" "." "-" "$"
        "SPC" "=" "_" "*" "\"" "'" "`" "+" "~" "?"
        "!" "@" "#" "%" "^" "&amp;" "|" "," ";" ":"
        "(" ")" "{" "}" "[" "]" "&lt;" "&gt;" "/" "\\"
        ))
(dolist (k self-insert-keys)
  (apply #'keymap-set (list global-map k #'self-insert-command)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4e68770" class="outline-2">
<h2 id="org4e68770"><span class="section-number-2">7.</span> Bind Some Low-Level Commands</h2>
<div class="outline-text-2" id="text-7">
<p>
Define some functions that seem relatively fundamental to dealing with
commands in general.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(bind-keys :map global-map
           ("C-g" . keyboard-quit)
           ("M-x" . execute-extended-command)
           ("M-:" . eval-expression))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7db444a" class="outline-2">
<h2 id="org7db444a"><span class="section-number-2">8.</span> Provide Some Basic Editing</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-orgbe69b11" class="outline-3">
<h3 id="orgbe69b11"><span class="section-number-3">8.1.</span> Insert Content</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(bind-keys :map global-map
           ("C-q" . quoted-insert)
           ("RET" . newline)
           ("C-j" . electric-newline-and-maybe-indent)
           ("TAB" . indent-for-tab-command)
           ("C-o" . open-line))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5faae42" class="outline-3">
<h3 id="org5faae42"><span class="section-number-3">8.2.</span> Remove Content</h3>
<div class="outline-text-3" id="text-8-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(bind-keys :map global-map
           ("DEL"  . backward-delete-char-untabify)
           ("M-DEL" . backward-kill-word)
           ;; Chrome OS support
           ("&lt;deletechar&gt;" . backward-kill-word)
           ("C-d" .  delete-char)
           ("C-w" . kill-region)
           ("M-d" . kill-word)
           ("C-k" . kill-line)
           ("M-\\" . delete-horizontal-space)
           ("M-z" . zap-up-to-char))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfed016d" class="outline-2">
<h2 id="orgfed016d"><span class="section-number-2">9.</span> Support Moving Point Around Within a Buffer</h2>
<div class="outline-text-2" id="text-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(bind-keys :map global-map
           ("C-f" . forward-char)
           ("C-b" . backward-char)
           ("C-n" . next-line)
           ("C-p" . previous-line)
           ("C-e" . move-end-of-line)
           ("C-a" . move-beginning-of-line)
           ("M-f" . forward-word)
           ("M-b" . backward-word)
           ("M-n" . forward-list)
           ("M-p" . backward-list)
           ("M-&gt;" . end-of-buffer)
           ("M-&lt;" . beginning-of-buffer)
           ("M-}" . forward-paragraph)
           ("M-{" . backward-paragraph)
           ("C-v" . scroll-up-command)
           ("M-v" . scroll-down-command))

</pre>
</div>
</div>
</div>

<div id="outline-container-org5a94cde" class="outline-2">
<h2 id="org5a94cde"><span class="section-number-2">10.</span> Change View of Buffer</h2>
<div class="outline-text-2" id="text-10">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(bind-keys :map global-map
           ("C-l" . recenter-top-bottom))
</pre>
</div>
</div>
</div>

<div id="outline-container-org45ea22a" class="outline-2">
<h2 id="org45ea22a"><span class="section-number-2">11.</span> Play With Mark</h2>
<div class="outline-text-2" id="text-11">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(bind-keys :map global-map
           ("C-SPC" . set-mark-command)
           ("C-x h" . mark-whole-buffer))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf03abc9" class="outline-2">
<h2 id="orgf03abc9"><span class="section-number-2">12.</span> Work with Kill Ring</h2>
<div class="outline-text-2" id="text-12">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(bind-keys :map global-map
           ("C-y" . yank)
           ("M-y" . yank-pop)
           ("M-w" . kill-ring-save))
</pre>
</div>
</div>
</div>

<div id="outline-container-org72b9a87" class="outline-2">
<h2 id="org72b9a87"><span class="section-number-2">13.</span> Provide Some Contextual Editing</h2>
<div class="outline-text-2" id="text-13">
<p>
While much editing is fairly indifferent to the underlying content,
some may vary behavior slightly based on its context. This does not
extend to include more sophisticated behaviors that require deeper
knowledge of syntactical elements.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(bind-keys :map global-map
           ("M-u" . upcase-word)
           ("M-;" . comment-dwim))

</pre>
</div>
</div>
</div>

<div id="outline-container-org80cf6f4" class="outline-2">
<h2 id="org80cf6f4"><span class="section-number-2">14.</span> Generate Content</h2>
<div class="outline-text-2" id="text-14">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(bind-keys :map global-map
           ("M-/" . dabbrev-expand)
           ("M-SPC" . complete-symbol))

</pre>
</div>
</div>
</div>

<div id="outline-container-orga528ef0" class="outline-2">
<h2 id="orga528ef0"><span class="section-number-2">15.</span> Searching and Potentially Replacing</h2>
<div class="outline-text-2" id="text-15">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(bind-keys :map global-map
           ("C-s" . isearch-forward)
           ("C-r" . isearch-backward)
           ("M-%" . query-replace)
           ("M-." . xref-find-definitions))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0b6b5c" class="outline-2">
<h2 id="orgc0b6b5c"><span class="section-number-2">16.</span> Support Some Inter-Process Communication</h2>
<div class="outline-text-2" id="text-16">
</div>
<div id="outline-container-org0a147be" class="outline-3">
<h3 id="org0a147be"><span class="section-number-3">16.1.</span> Support Invoking of External Commands</h3>
<div class="outline-text-3" id="text-16-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(bind-keys :map global-map
           ("M-!" . shell-command))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb1d1ba7" class="outline-2">
<h2 id="orgb1d1ba7"><span class="section-number-2">17.</span> Provide Some Global Dispatching</h2>
<div class="outline-text-2" id="text-17">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(bind-keys :prefix "C-x C-z"
           :prefix-map dispatch-map
           ("a" . org-agenda)
           ("g" . gnus)
           ("m" . gnus-summary-mail-other-window)
           ("s" . shell)
           ("v" . view-mode)
           ("w" . eww))

</pre>
</div>
</div>

<div id="outline-container-org571b9be" class="outline-3">
<h3 id="org571b9be"><span class="section-number-3">17.1.</span> Handle Escape Sequences from External Commands</h3>
<div class="outline-text-3" id="text-17-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'compilation-filter-hook 'ansi-color-compilation-filter)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0bdc3fa" class="outline-2">
<h2 id="org0bdc3fa"><span class="section-number-2">18.</span> Manage View Objects</h2>
<div class="outline-text-2" id="text-18">
<p>
Deal with buffers and windows. I'm currently lumping these together
and customizing their binding a bit to make use of the `C-M`
modifier combination. This is an experimental shift, but in a past
adoption of Emacs I remember doing something or other to rebind window
resizing such that it did not require a chain and as these operations
are so fundamental this seems like a potentially nice route.
</p>

<p>
These are global and since the prefix is likely used elsewhere they
are forced using `bind-keys*` to stick them in the override map.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(bind-keys* ("C-M-n" . next-buffer)
            ("C-M-&lt;right&gt;" . next-buffer)
            ("C-M-p" . previous-buffer)
            ("C-M-&lt;left&gt;" . previous-buffer)
            ("C-M-b" . switch-to-buffer)
            ("C-M-k" . kill-buffer)
            ("C-M-l" . list-buffers)
            ("C-M-s" . save-buffer)
            ("C-M-0" . delete-window)
            ("C-M-1" . delete-other-windows)
            ("C-M-2" . split-window-below)
            ("C-M-3" . split-window-right)
            ("C-M-o" . other-window)
            ("C-M-}" . enlarge-window-horizontally)
            ("C-M-{" . shrink-window-horizontally)
            ("C-M-]" . enlarge-window)
            ("C-M-[" . shrink-window))
</pre>
</div>
</div>
</div>

<div id="outline-container-org86dddf3" class="outline-2">
<h2 id="org86dddf3"><span class="section-number-2">19.</span> Help Me!</h2>
<div class="outline-text-2" id="text-19">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(bind-keys :prefix "C-h"
           :prefix-map help-map
           :prefix-docstring "Help me!"
           ("b" . describe-bindings)
           ("f" . describe-function)
           ("i" . info)
           ("k" . describe-key)
           ("l" . view-lossage)
           ("m" . describe-mode)
           ("p" . describe-package)
           ("v" . describe-variable)
           ("w" . where-is))

</pre>
</div>
</div>
</div>

<div id="outline-container-org64a594c" class="outline-2">
<h2 id="org64a594c"><span class="section-number-2">20.</span> Bookmark Management</h2>
<div class="outline-text-2" id="text-20">
<p>
Bookmarks are a feature I'm not actively using at the moment but this
configuration has been carried forward from previous configuration.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(bind-keys :prefix "C-x C-r"
           :prefix-map bookmark-map
           ("m" . bookmark-set))
(setq bookmark-save-flag 1)

</pre>
</div>
</div>
</div>

<div id="outline-container-org11273b6" class="outline-2">
<h2 id="org11273b6"><span class="section-number-2">21.</span> Define Some Minibuffer Bindings</h2>
<div class="outline-text-2" id="text-21">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(bind-keys :map minibuffer-mode-map
           ("TAB" . minibuffer-complete)
           ("RET" . exit-minibuffer)
           ("M-n" . next-history-element)
           ("M-p" . previous-history-element))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6bc0e90" class="outline-2">
<h2 id="org6bc0e90"><span class="section-number-2">22.</span> Define Some Navigation Through a Project</h2>
<div class="outline-text-2" id="text-22">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(bind-keys :map global-map
           ("C-x C-f" . ffap)
           ("C-x `" . next-error))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgd58a784" class="outline-2">
<h2 id="orgd58a784"><span class="section-number-2">23.</span> Interact With Source Control</h2>
<div class="outline-text-2" id="text-23">
<p>
Initially this section is just going to contain some bindings that I
copied from a previous incarnation of my Emacs configuration.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(bind-keys :map global-map
           ("C-x v v" . vc-next-action)
           ("C-x v d" . vc-dir))

(use-package vc
  :bind (:map vc-dir-mode-map
              ("M-m" . vc-dir-mark)
              ("M-u" . vc-dir-unmark)
              ("M-=" . vc-diff)))

</pre>
</div>
</div>
</div>

<div id="outline-container-org8f8599c" class="outline-2">
<h2 id="org8f8599c"><span class="section-number-2">24.</span> Configure Org Mode</h2>
<div class="outline-text-2" id="text-24">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'auto-mode-alist '("\\.org\\'" . org-mode))

 (use-package org
   :bind
   (:prefix "C-x C-o"
    :prefix-map global-org-map
    :prefix-docstring "Globally used org mode keys"
    ("a" . org-agenda)
    ("c" . org-capture)
    ("C-&lt;SPC&gt;" . org-store-link))

   (:map org-mode-map
   ("DEL" . org-delete-backward-char)
   ("TAB" . org-cycle)
   ("M-RET" . org-meta-return)
   ("M-&lt;right&gt;" . org-metaright)
   ("M-&lt;left&gt;" . org-metaleft)
   ("M-&lt;down&gt;" . org-metadown)
   ;; Chrombook
   ("&lt;next&gt;" . org-metadown)
   ("M-&lt;up&gt;" . org-metaup)
   ("C-a" . org-beginning-of-line)
   ("C-k" . org-kill-line)
   ("C-c d" . org-deadline)
   ("C-c q" . org-set-tags-command)
   ("C-c s" . org-schedule)
   ("C-c t" . org-todo)
   ("C-c w" . org-refile)
   ("C-x RET" . org-open-at-point)
   ("C-M-_" . org-cycle)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgff24eb4" class="outline-2">
<h2 id="orgff24eb4"><span class="section-number-2">25.</span> Configure Dired Mode</h2>
<div class="outline-text-2" id="text-25">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired
  :bind (:map dired-mode-map
  ("C-p" . dired-previous-line)
  ("C-n" . dired-next-line)
  ("RET" . dired-find-file)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4cef713" class="outline-2">
<h2 id="org4cef713"><span class="section-number-2">26.</span> Configure Org Agenda</h2>
<div class="outline-text-2" id="text-26">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package org-agenda
  :bind (:map org-agenda-mode-map
  ("C-n" . org-agenda-next-line)
  ("C-p" . org-agenda-previous-line)
  ("TAB" . org-agenda-goto)
  ("g" . org-agenda-redo-all)
  ("t" . org-agenda-todo)
  ("u" . org-agenda-bulk-unmark)
  ("T" . org-agenda-show-tags))
  :config
  (setq org-agenda-span 'day)
  ;; Allow for very old scheduled items for catch-up behavior.
  (setq org-scheduled-past-days 99999)
  ;; Use hl-line mode in org-agenda for visibilitiy
  (add-hook 'org-agenda-mode-hook 'hl-line-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6d7ebd1" class="outline-2">
<h2 id="org6d7ebd1"><span class="section-number-2">27.</span> Configure hexl Mode</h2>
<div class="outline-text-2" id="text-27">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package hexl
  :bind (:map hexl-mode
  ("C-v" . hexl-scroll-up)
  ("M-v" . hexl-scroll-down)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf960c05" class="outline-2">
<h2 id="orgf960c05"><span class="section-number-2">28.</span> Configure Info Mode</h2>
<div class="outline-text-2" id="text-28">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package info
  :bind (:map Info-mode-map
  ("SPC" . Info-scroll-up)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5201d7f" class="outline-2">
<h2 id="org5201d7f"><span class="section-number-2">29.</span> Configure Emacs Lisp</h2>
<div class="outline-text-2" id="text-29">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(add-to-list 'auto-mode-alist '("\\.el\\'" . emacs-lisp-mode))
(global-dash-fontify-mode)
(with-eval-after-load 'info-look
  (dash-register-info-lookup))
(bind-keys :map global-map
           ("C-x C-e" . eval-last-sexp))

</pre>
</div>
</div>
</div>

<div id="outline-container-org4cb938e" class="outline-2">
<h2 id="org4cb938e"><span class="section-number-2">30.</span> Manage Environment for Called Commands</h2>
<div class="outline-text-2" id="text-30">
<p>
Some operating systems (such as OS X) will invoke Emacs with a
separate profile that may not include configuration that has been
defined for login sessions such as environment variables.
</p>

<p>
This basically steals the logic from exec-path-from-shell (to link)
but the code itself is a bit dumber and is more oriented towards
building out a larger code base rather than providing drop-in
functionality.
</p>

<p>
Most of the constructs here will be prefixed with <code>^-env</code> but those
that are more general will omit the <code>env</code> segment.
</p>
</div>

<div id="outline-container-orgb56d76e" class="outline-3">
<h3 id="orgb56d76e"><span class="section-number-3">30.1.</span> Customization Group</h3>
<div class="outline-text-3" id="text-30-1">
<p>
I have not used customize in the past, but in addition to providing a
user interface which may be more usable across devices it also seems
to offer a natural means to locally specialize behavior without
worrying about what goes into which file.
</p>

<p>
These will be functions which in some places helps reduce the overall
complexity while retaining flexibility, and others are done largely
for consistency. The large possible drawback is that this pushes more
power and required expertise to the user (but additional protections
and conveniences could be layered off if desired).
</p>

<p>
Initially <code>funcall</code> will be used fairly liberally until I stumble across
a means to identify variables as functions and push Emacs lisp closer
to a lisp 1 (I know such mechanisms are readily available but I'm just
not actively looking).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defgroup ^-env
  nil
  "Tune the environment."
  :prefix "^-env"
  :group 'environment)
</pre>
</div>
</div>
</div>

<div id="outline-container-org388b67e" class="outline-3">
<h3 id="org388b67e"><span class="section-number-3">30.2.</span> Expand Using Shell</h3>
<div class="outline-text-3" id="text-30-2">
<p>
The underlying functionality revolves around evaluating expressions in
a shell which is invoked with the login profile. Much of this <span class="underline">may</span> be
able to be further generalized but there's currently no clear path or
reason to do so.
</p>

<p>
At the high level such expansion will be done by wrapping the name as
a shell parameter and then passing it through the fairly ubiquitous
<code>printf</code> function.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun ^-shell-expand (name)
  (let ((shell-variable (^-enveloper '("${" . "}"))))
    (^-shell-printf "%s" (funcall shell-variable name))))

</pre>
</div>
</div>

<div id="outline-container-orgcfdcd07" class="outline-4">
<h4 id="orgcfdcd07"><span class="section-number-4">30.2.1.</span> Enveloper</h4>
<div class="outline-text-4" id="text-30-2-1">
<p>
The above uses an "enveloper" which wraps a string in the provided
pair. There's some similar behavior that seems worth extracting
into an object when I get to reading about some of the object
libraries in Emacs (it doesn't seem worth going the manual route of
routing messages).
</p>

<p>
This makes use of currying since&#x2026;I like currying. More specifically
I think use of partial applications in local variables can provide
tidy invocations of general blocks. Later on I'll probably make use of
some library or other (dash?) to provide a range of functional
programming behavior for me.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun ^-enveloper (pair)
  "Produce a function which will wrap a string within pair."
  (lambda (s) (concat (car pair) s (cdr pair))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org42f378a" class="outline-4">
<h4 id="org42f378a"><span class="section-number-4">30.2.2.</span> Define the Called Commands</h4>
<div class="outline-text-4" id="text-30-2-2">
</div>
<ol class="org-ol">
<li><a id="orgf2e3b3b"></a>Shell Supplier<br />
<div class="outline-text-5" id="text-30-2-2-1">
<p>
The evaluation itself will be performed through a shell command which
is defined here, defaulting to the Emacs standard.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defcustom ^-env-shell-supplier
  (lambda () shell-file-name)
  "Define the function which will return the shell to invoke
   along with any additional arguments."
  :type 'function
  :group '^-env)
</pre>
</div>
</div>
</li>

<li><a id="orgb0190f7"></a>Shell Login Argument Supplier<br />
<div class="outline-text-5" id="text-30-2-2-2">
<p>
The shell command may also require some additional arguments to make
sure that it is executed using the login profile.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defcustom ^-env-shell-login-arg-supplier
  (lambda () '("-l" "-i"))
  "Define the function which will return arguments that when
   passed to the shell will operate in login mode."
  :type 'function
  :group '^-env)
</pre>
</div>
</div>
</li>

<li><a id="org4262e91"></a>Printf Command Supplier<br />
<div class="outline-text-5" id="text-30-2-2-3">
<p>
As previously mentioned this will expect to be evaluated using some
form of printf&#x2026;how practically extensible this is given the current
logic seems unclear - likely most of these functions would be better
off as being passed the argument they're expanding but all of that
feels like premature generalization and right now the goal is just to
define some of the magic values.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defcustom ^-env-printf-supplier
  (lambda () "printf")
  "Define the function which will return the printf command
   to be invoked by the shell."
  :type 'function
  :group '^-env)
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org1b8eb3f" class="outline-4">
<h4 id="org1b8eb3f"><span class="section-number-4">30.2.3.</span> Support Invoking the Commands</h4>
<div class="outline-text-4" id="text-30-2-3">
<p>
There's likely some better constructs for this floating around
somewhere, but for now I'll start with what was inherited.
</p>
</div>

<ol class="org-ol">
<li><a id="orga877989"></a>Warn On Slow Evaluation<br />
<div class="outline-text-5" id="text-30-2-3-1">
<p>
Warning on a slow call is carried forward from exec-from-shell&#x2026;I'm
not entirely sure of its value given that there's no timeout behavior
and the execution is not typically done repeatedly.  I'd conjecture
that maybe this is useful as such slow executions could produce
undesirably slow Emacs start times. In any case it seems worth keeping
around for the time being.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defcustom ^-env-warn-evaluation-duration-millis-supplier
  (lambda () 500)
  "Print a warning if evaluation duration exceeds this number of milliseconds."
  :type 'function
  :group '^-env)
</pre>
</div>
</div>
</li>

<li><a id="org123ac0a"></a>Support Timed Evaluation<br />
<ol class="org-ol">
<li><a id="org8ad35ba"></a><span class="todo TODO">TODO</span> Replace with <code>with-delayed-message</code><br />
<div class="outline-text-6" id="text-30-2-3-2-1">
<p>
There's nothing particularly specialized about timing a call so this
will be implemented through providing a first class function which
takes a curried handler to which the time will be passed and can then
be passed any body as a thunk which will be evaluated and timed.
This would almost certainly be more idiomatically a macro in Emacs
lisp but I tend to avoid that (which will be covered separately at
some point).
</p>

<p>
The implementation is typical timer behavior of tracking start time
and then reporting the difference between the start and end times (in
this case passing it to the handler. A general note (not specific to
this code or language) is that it is often desirable to consistently
report the time and therefore any calls that return through alternate
paths (such as exceptions) should also be tracked (and preferably
annotated accordingly). This is optimistically ignored for this code
(and I'd typically prefer Either semantics over exceptions which makes
that issue simpler to reason about) but that scenario may need further
attention with this code.
</p>
</div>
</li>

<li><a id="org3044a30"></a>Millisecond Duration<br />
<div class="outline-text-6" id="text-30-2-3-2-2">
<p>
The duration will be passed in milliseconds as that's what's inherited
from the original logic. This also generally seems to be the most
common unit for timing application code - it is appropriate for
relatively slow actions like invoking another process and faster
actions can be timed in aggregates which can help smooth out the many
things can skew sub-millisecond timings.
</p>

<p>
This provides a basic implementation to calculate such a duration
from two timestamps using Emacs functionality. There may be a
date/time library floating around that could replace this later.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun ^-temporal-diff-millis (start end)
  (thread-last start
              (time-subtract end)
              float-time
              (* 1000.0)))
</pre>
</div>
</div>
</li>

<li><a id="orgb12c927"></a>Implement Timer<br />
<div class="outline-text-6" id="text-30-2-3-2-3">
<p>
This function body is a fairly straightforward higher-order
function. Currently the handler will be invoked with <code>funcall</code> (which
should be modified later).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun ^-timed (handler)
  "Produce a function that will invoke thunks and return their value
   while also passing the execution duration to &lt;handler&gt;."
  (lambda (thunk)
    (let* ((start-time (current-time))
           (result (funcall thunk))
           (duration (^-temporal-diff-millis start-time (current-time))))
      (funcall handler duration)
      result)))
</pre>
</div>
</div>
</li>

<li><a id="org80f4bda"></a>Wire Warning<br />
<div class="outline-text-6" id="text-30-2-3-2-4">
<p>
The specific handler for the duration warning needs to be configured
to be plugged into the general timer. This will be provided by a
closure over the setting which returns an appropriate handler.
</p>
</div>
</li>
</ol>
</li>
</ol>
</div>

<div id="outline-container-orgadb7876" class="outline-4">
<h4 id="orgadb7876"><span class="section-number-4">30.2.4.</span> Transplants</h4>
<div class="outline-text-4" id="text-30-2-4">
<p>
The environment variables that should be carried across profiles will
be called "transplants".
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defcustom ^-env-variable-transplants-supplier
  (lambda '("MANPATH"))
  "List of environment variables which will be transplanted on initialization."
  :group '^-env)
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org022c295" class="outline-2">
<h2 id="org022c295"><span class="section-number-2">31.</span> Structurizr Mode</h2>
<div class="outline-text-2" id="text-31">
<p>
The details of some of these should be covered. Why does
font-lock-defaults require a nested list?
</p>

<p>
For now there is no hook defined since it wouldn't be used
(although it is likely to be standard).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-derived-mode structurizr-mode fundamental-mode "Structurizr"
  "Major mode for editing Structurizr dsl"
  (set-syntax-table structurizr-mode-syntax-table)
  (make-local-variable 'structurizr-indent-offset)
  (set (make-local-variable 'indent-line-function) 'structurizr-indent-line)
  (setq font-lock-defaults (list (funcall structurizr-font-lock-default-collector))))
</pre>
</div>
</div>

<div id="outline-container-org8285092" class="outline-3">
<h3 id="org8285092"><span class="section-number-3">31.1.</span> Font Lock</h3>
<div class="outline-text-3" id="text-31-1">
<p>
The definitions below are borrowed from the original mode, this should
tied back more directly to the DSL reference with any resulting
adjustment to naming or membership.
</p>
</div>

<div id="outline-container-orgfbc5c31" class="outline-4">
<h4 id="orgfbc5c31"><span class="section-number-4">31.1.1.</span> Words for Face</h4>
<div class="outline-text-4" id="text-31-1-1">
<p>
The original code also defined and then operated on values whereas
this will attempt to make more use of in-place definitions with
supporting functions as warranted.
</p>

<p>
This seems like something that likely already exists but to start this
will make use of what was originally in place but wrap it up in a
function for more direct use.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun ^-words-for-face (face words)
  "Return a pair of a regexp matching &lt;words&gt; and the provided &lt;face&gt;."
  (cons (regexp-opt words 'words) face))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd8df78" class="outline-4">
<h4 id="orgdd8df78"><span class="section-number-4">31.1.2.</span> List Collector</h4>
<div class="outline-text-4" id="text-31-1-2">
<p>
There is likely something readily available somewhere else that does
this. When defining keywords in this file it is nice to allow each
block to be self-contained so that it can be evaluated easily, but
when collecting all lists that invites some possibly fragile
mutability. To make this slightly cleaner, at least according to my
tastes, we'll use an accumulator closure over the list that appends an
argument if provided and returns the contents if no argument is provided.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun ^-list-collector ()
  "Produce a list collector."
  (let ((l nil))
    (lambda (&amp;optional arg)
      (if arg (push arg l) l))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9d445b5" class="outline-4">
<h4 id="org9d445b5"><span class="section-number-4">31.1.3.</span> Collect Categories of Known Words</h4>
<div class="outline-text-4" id="text-31-1-3">
<p>
Each block will push onto the list to keep the blocks self-contained.
</p>

<p>
There's a note around ordering being significant&#x2026;ideally this can be
avoided if it is substantiated but otherwise it should be very clearly
laid out or ideally encoded within the logic.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setq structurizr-font-lock-default-collector (^-list-collector))
</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="org6669aa6"></a>Keywords<br />
<div class="outline-text-5" id="text-31-1-3-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(funcall structurizr-font-lock-default-collector
         (^-words-for-face
          'font-lock-keyword-face
          '(
            "enterprise"
            "model"
            "views"
            "workspace"
            )))
</pre>
</div>
</div>
</li>

<li><a id="orgfebff3e"></a>Types<br />
<div class="outline-text-5" id="text-31-1-3-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(funcall structurizr-font-lock-default-collector
         (^-words-for-face
          'font-lock-type-face
          '(
            "branding"
            "component"
            "container"
            "containerInstance"
            "deployment"
            "deploymentEnvironment"
            "deploymentGroup"
            "deploymentNode"
            "dynamic"
            "element"
            "filtered"
            "group"
            "infrastructureNode"
            "person"
            "perspectives"
            "properties"
            "relationship"
            "softwareSystem"
            "softwareSystemInstance"
            "styles"
            "systemContext"
            "systemLandscape"
            "themes"
            )))
</pre>
</div>
</div>
</li>

<li><a id="org65b61e2"></a>Relationship<br />
<div class="outline-text-5" id="text-31-1-3-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(funcall structurizr-font-lock-default-collector
         (^-words-for-face
          'font-lock-function-name-face
          '("-&gt;")))
</pre>
</div>
</div>
</li>

<li><a id="org20370b0"></a>Properties<br />
<div class="outline-text-5" id="text-31-1-3-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(funcall structurizr-font-lock-default-collector
         (^-words-for-face
          'font-lock-variable-name-face
          '(
            "autoLayout"
            "background"
            "border"
            "color"
            "colour"
            "dashed"
            "description"
            "exclude"
            "fontSize"
            "height"
            "icon"
            "include"
            "metadata"
            "opacity"
            "position"
            "routing"
            "shape"
            "stroke"
            "tags"
            "technology"
            "thickness"
            "title"
            "url"
            "width")))
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org28e35a0" class="outline-3">
<h3 id="org28e35a0"><span class="section-number-3">31.2.</span> Indentation</h3>
<div class="outline-text-3" id="text-31-2">
</div>
<div id="outline-container-orgdbe88f6" class="outline-4">
<h4 id="orgdbe88f6"><span class="section-number-4">31.2.1.</span> Configure Offset</h4>
<div class="outline-text-4" id="text-31-2-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defvar structurizr-indent-offset 4
  "Define the indentation offset for `structurizr-mode'.
Lines will be indented this offset multiplied by the detected level.
Currently only spaces are supported.")

</pre>
</div>
</div>
</div>

<div id="outline-container-org15ab8a3" class="outline-4">
<h4 id="org15ab8a3"><span class="section-number-4">31.2.2.</span> Determine Indentation Level</h4>
<div class="outline-text-4" id="text-31-2-2">
<p>
The basic algorithm here will start from what was defined upstream.
This will be broken up a bit and in the future any other standard
algorithms will be explored.
</p>

<p>
This currently adjusts the formatting after a newline rather than
inserting the character itself so something more electric may be better.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun structurizr-indent-line ()
  "Indent current line as Structurizr dsl."
  (interactive)
  (let* ((initial-level (^-opener-count-to-top "{"))
         (closers (^-closers-on-line "}"))
         (level (max 0 (- initial-level closers))))
    (indent-line-to (* level structurizr-indent-offset))))

</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="orgc762c44"></a>Opener Count to Top<br />
<div class="outline-text-5" id="text-31-2-2-1">
<p>
The current approach involves ascending lists until an ignored error
is encountered, and then reporting the count of the number of a
particular opener that was encountered.
</p>

<p>
This feels like it should be simpler in some way or another. This
level should potentially be readily available and the ascension
behavior should be tied to the relevant grammar which would obviate
the need for the additional check. At the moment I don't know what
options are available and unused versus those that would need further
support so I'll circle back to this over time (especially as other
modes are pulled in).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun ^-opener-count-to-top (opener)
  "Ascend through levels and count the number of &lt;opener&gt;s seen."
  (let ((level 0))
    (save-excursion
      (beginning-of-line)
      (condition-case nil
          (while t
            (backward-up-list 1)
            (when (looking-at opener)
              (setq level (+ level 1))))
        (error nil)))
    level))
</pre>
</div>
</div>
</li>

<li><a id="org054d6be"></a>Closer Count<br />
<div class="outline-text-5" id="text-31-2-2-2">
<p>
The current logic only decrements one if the first character is a
closer. This may be nicer to just count all instances but that feels
like a taste based on the resulting behavior. In any case it should
likely support either.
</p>

<p>
In the current form this will either return 0 or 1.
</p>

<p>
There was also a separate test initially which seemed to look to
prevent over-outdenting which can be addressed by a ramp function on
outside use.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun ^-closers-on-line (closer)
  (save-excursion
    (back-to-indentation)
    (if (looking-at closer) 1 0)))
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org2351021" class="outline-3">
<h3 id="org2351021"><span class="section-number-3">31.3.</span> Syntax Table</h3>
<div class="outline-text-3" id="text-31-3">
<p>
The standard syntax table function <code>newentry</code> value is bit arcane so
I'm going to try to define some more expressive functions to produce
the values (and likely find something that exists elsewhere).
</p>

<p>
This can be generalized a bit as needed by producing functions which
produce the first character but in the short term the only interesting
one I need is for punctuation so that will be written as
specialized. The underlying logic can then be a function which accepts
named flags as keywords each of which will map to the underlying terse flag.
</p>

<p>
Initially I'll use a fairly clunky <code>cond</code> block though there is almost
certainly something cleaner. This could be cleaned up through partial
application but I'd imagine there's some better pattern matching stuff
I need to stumble upon.
</p>

<p>
This should all be significantly cleaned up into a nicer DSL (or
ideally an existing one found) but right now I'm starting with the
basics. In particular the relationships between some of the flags
should be modeled in that DSL whereas the naive approach allows for
seemingly invalid combinations. These should also operate on a closure
over a comment table.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun ^-syntax-table-punctuation (&amp;rest flags)
  (apply #'concat (cons ". "
          (mapcar (lambda (flag)
                    (cond
                     ((eq flag :start-2char-comment-open) "1")
                     ((eq flag :end-2char-comment-open) "2")
                     ((eq flag :start-2char-comment-close) "3")
                     ((eq flag :end-2char-comment-close) "4")
                     ((eq flag :for-comment-sequence-b) "b")
                    (t (error "Unrecognized flag" flag))))
                  flags))))
(defun ^-syntax-table-comment-ender () "&gt;")

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq structurizr-mode-syntax-table
  (let ((syntax-table (make-syntax-table)))
    (modify-syntax-entry
      ?/
      (^-syntax-table-punctuation
        :start-2char-comment-open
        :end-2char-comment-open
        :end-2char-comment-close)
      syntax-table)
    (modify-syntax-entry
      ?*
      (^-syntax-table-punctuation
        :end-2char-comment-open
        :start-2char-comment-close
        :for-comment-sequence-b))
    (modify-syntax-entry ?\n (^-syntax-table-comment-ender) syntax-table)
    syntax-table))

</pre>
</div>
</div>
</div>

<div id="outline-container-org1a69499" class="outline-3">
<h3 id="org1a69499"><span class="section-number-3">31.4.</span> Associate with Extension</h3>
<div class="outline-text-3" id="text-31-4">
<p>
<code>dsl</code> is certainly not unambiguously Strucutrizr files,
but it's the only association I'm currently expecting.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(add-to-list 'auto-mode-alist '("\\.dsl\\'" . structurizr-mode))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org39caf2d" class="outline-2">
<h2 id="org39caf2d"><span class="section-number-2">32.</span> Programming Support</h2>
<div class="outline-text-2" id="text-32">
<p>
This is currently copied forward but past configurations but not
revisited. It looks as though this is the beginning of seeking to
support code collapsing.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(add-hook 'prog-mode-hook hs-minor-mode)
(bind-keys :map prog-mode-map
           ("C-M-_". hs-toggle-hiding))

</pre>
</div>
</div>

<div id="outline-container-orgc156ced" class="outline-3">
<h3 id="orgc156ced"><span class="section-number-3">32.1.</span> C</h3>
<div class="outline-text-3" id="text-32-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(add-to-list 'auto-mode-alist '("\\.c\\'" . c-mode))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc0c6fac" class="outline-2">
<h2 id="orgc0c6fac"><span class="section-number-2">33.</span> Configure Lilypond</h2>
<div class="outline-text-2" id="text-33">
<p>
This is the very beginning of support for Lilypond mode, which I think
I started to copy from the Lilypond source code years ago. This is
unlikely to provide any valuable in its current form and so will
either be built upon further later or removed.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
  (defvar LilyPond-mode-map ()
    "Keymap used in `LilyPond-mode' buffers.")

  (defun LilyPond-mode ()
    "Major mode for editing LilyPond music files.

This mode knows about LilyPond keywords and line comments, not abou
indentation or block comments.  It features easy compilation, error
finding and viewing of a LilyPond source buffer or region.

COMMANDS
\\{LilyPond-mode-map}
VARIABLES

LilyPond-command-alist\t\talist from name to command"
    (interactive)
    ;; set up local variables
    (kill-all-local-variables))

(add-to-list 'auto-mode-alist '("\\.ly$" . LilyPond-mode))
(add-to-list 'auto-mode-alist '("\\.ily$" . LilyPond-mode)))

</pre>
</div>
</div>
</div>

<div id="outline-container-orga3294d5" class="outline-2">
<h2 id="orga3294d5"><span class="section-number-2">34.</span> Configure Gnus</h2>
<div class="outline-text-2" id="text-34">
<p>
I'm currently using Gnus to read my mail but have not yet dug into it
again - this like many others reflect inherited previous configuration options.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; This should be cleaned up a bit but was just implemented in the most
;; obvious way for now.
(defun gnus-group-read-50 ()
  (interactive)
  (gnus-group-read-group 50))

(use-package gnus
  :bind (:map gnus-group-mode-map
         ("M-g" . gnus-group-get-new-news-this-group)
         ("M-&lt;down&gt;" . gnus-group-read-50)
         :map gnus-summary-mode-map
         ("M-&lt;down&gt;" . gnus-summary-next-page)
         ("C-c m" . gnus-summary-move-article)))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgb38b95a" class="outline-2">
<h2 id="orgb38b95a"><span class="section-number-2">35.</span> Configure EWW</h2>
<div class="outline-text-2" id="text-35">
<p>
On Linux I may explore EAF but for now I'll be using EWW since EAF is
currently Linux only and isn't working particularly well as configured
on my Sway installation.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package eww
  :bind (:map eww-mode-map
              ("C-c w" . eww-copy-page-url)))
(setq browse-url-browser-function 'eww-browse-url)

</pre>
</div>
</div>
</div>

<div id="outline-container-org7c08f0c" class="outline-2">
<h2 id="org7c08f0c"><span class="section-number-2">36.</span> Queue</h2>
<div class="outline-text-2" id="text-36">
</div>
<div id="outline-container-orgb86bc73" class="outline-3">
<h3 id="orgb86bc73"><span class="section-number-3">36.1.</span> <span class="todo TODO">TODO</span> Find or define more expressive mode-alist registration</h3>
<div class="outline-text-3" id="text-36-1">
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2023-07-28 Fri 15:16</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>